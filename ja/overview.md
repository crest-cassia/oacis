---
layout: default
title: "システム概要"
lang: ja
next_page: install
---

# {{ page.title }}

この章では、OACISの全体像の理解のために、システム構成とデータ構造について説明する。

---

## システム構成

OACISは、Ruby on Railsフレームワークを用いて構築されており、ユーザーはウェブブラウザを用いて実行したシミュレーション結果などにアクセスすることができる。
内部のデータベースとしてMongoDBを使用しており、シミュレーション実行時の情報、パラメータについての情報、ホストについての情報などが格納される。
シミュレータが出力したファイルやディレクトリについては、ファイルシステム上(publicディレクトリ以下)に保存される。
システム構成の概要は下図のようになる。

![システム構成]({{ site.baseurl }}/images/system_configuration_num.png){:width="400px"}

ユーザーがシミュレーション実行をリクエストしてから、シミュレーション結果をOACISに保存するまでの処理の流れの概要は以下のとおりである。

1. まずユーザーがウェブブラウザ（①）上で実行したいシミュレーションを指定する。
1. リクエストはウェブサーバー上（②）で処理され、Workerと呼ばれるデーモンプロセス（③）に処理を依頼する。
  * Workerとはバックグラウンドで、リモートホストへのSSH接続やファイル転送などの時間がかかる処理を担当するプロセスである。
1. Workerはユーザーによって指定されたシミュレーションをリモートホスト（④）で実行する。
  * Torqueなどのジョブスケジューラ経由でジョブが実行されるように各Hostごとに設定することができる。
  * シミュレータは事前にユーザーが各ホスト上でビルドして実行可能な状態にしておく。
    * 事前にシミュレータのパスをOACISに登録し、Workerがそのコマンドをシェルスクリプトに埋め込みリモートホストで実行する。
  * 各ジョブごとにリモートホスト上にディレクトリを作成し、その中でジョブが実行される。
1. リモートホストでの実行が完了後、Workerが実行結果をOACIS実行サーバーにSFTPでダウンロードする。
  * Workerが定期的にリモートホストをポーリングし、ジョブが完了したかどうか確認する。
  * ジョブの完了後、結果のファイルはファイルストレージ（⑤）およびDB（⑥）に格納される。
    * ジョブが実行されたディレクトリ以下に作成されたファイルはすべて結果のファイルとみなされ保存される。

格納された結果はブラウザからアクセス可能となる。

## データ構造の概略

OACISではシミュレーション結果は図の様なSimulator, ParameterSet, Runの３層構造に分けて保存される。

![データ構造]({{ site.baseurl }}/images/data_structure.png){:width="400px"}

Simulatorは複数のParameterSetを持ち、ParameterSetは複数のRunを持っている。
ParameterSetとはあるシミュレータを実行するのに必要なパラメータの値の組をさす概念で、Runとは独立なモンテカルロランの一つをさす概念である。

例として、単純な交通流シミュレータを考えよう。
この交通流シミュレータは、道路の長さL、信号周期T、車の台数Nを入力パラメータに持つシミュレータだとする。
ParameterSetとは、{L=100, T=10, N=10} などのパラメータの組み合わせのことをさす。
このパラメータセットで乱数の種を変えて５回シミュレーションを行うとすると、５つのRunが作成されることになる。

またそれぞれの結果に対して解析を実施する事もできる。
各Simulatorに対してAnalyzerを登録することができ、Simulatorと同様にリモートホストで実行される。
Analyzerの実行結果はAnalysisと呼ばれ、解析対象（ParameterSetまたはRun）の配下に格納される。

