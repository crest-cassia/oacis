= javascript_include_tag "explore/application"

= render partial: "shared/breadcrumb", locals: {links: breadcrumb_links_for(@simulator)}

- model_class = Simulator
.page-header
  %h1=t '.title', :default => @simulator.name

#pc-plot

%hr

.row
  .span4
    %table.table.table-striped
      %tbody
        %tr
          %th ParameterSet
          %td#current_ps_id= @param_set.id.to_s
          %td
          %td
        - domains = @simulator.parameter_ranges
        - @simulator.parameter_definitions.map(&:key).each do |key|
          %tr
            %th= key
            %td{id: "ps_v_#{key}", :"data-range" => domains[key] }= @param_set.v[key]
            %td{style: "padding-left: 0; padding-right: 0;"}
              - url = _neighbor_parameter_set_path('PSID') +".json?key=#{key}&direction=down"
              %i.icon-arrow-down{id: "ps_down_#{key}", data: {"neighbor-url" => url}}
            %td{style: "padding-left: 0; padding-right: 0;"}
              - url = _neighbor_parameter_set_path('PSID') +".json?key=#{key}&direction=up"
              %i.icon-arrow-up{id: "ps_up_#{key}", data: {"neighbor-url" => url}}
    %form.form-horizontal
      #scatter-plot-form
        - opts = @simulator.parameter_definitions.map(&:key)
        .control-group
          = label_tag 'x_axis_key', "X-Axis", class: 'control-label scatter-plot-label'
          .controls
            = select_tag 'x_axis_key', options_for_select(opts), id: 'x_axis_key'
        .control-group
          = label_tag 'y_axis_key', "Y-Axis", class: 'control-label scatter-plot-label'
          .controls
            = select_tag 'y_axis_key', options_for_select(opts, selected: opts[1]), id: 'y_axis_key'
        .control-group
          = label_tag 'result', "Result", class: 'control-label'
          .controls
            - opts = @simulator.plottable_domains.map {|key,domain| [key, key, {:"data-domain" => domain}] }
            = select_tag 'result', options_for_select(opts), id: 'result', include_blank: true
      #irrelevant-params.form-inline
        %br
        Irrelevant parameters :
        %br
        - @simulator.parameter_definitions.map(&:key).each do |key|
          = label_tag key, key
          = check_box_tag key
  .span8
    - urls = {"scatter-plot-url" => _scatter_plot_parameter_set_path('PSID') + '.json',
              "ps-url" => parameter_set_path('PSID')+'.json'}
    #plot{data: urls }
      #plot-tooltip.plot-tooltip{style: "opacity: 0;"}

:css
  .axis path,
  .axis line,
  .pcp-axis path,
  .pcp-axis line {
    fill: none;
    stroke: #000;
    shape-rendering: crispEdges;
  }
  div.plot-tooltip {
    position: absolute;
    text-align: center;
    padding: 2px;
    font: 12px sans-serif;
    background: black;
    color: white;
    border: 0px;
    border-radius: 8px;
    pointer-events: none;
    z-index: 10;
  }

:javascript
  $(function() {
    var ps_id = $('td#current_ps_id').text();
    initialize_pc_plot();
    draw_explorer(ps_id);
  });

  function on_select_change() {
    var ps_id = $('td#current_ps_id').text();
    update_explorer(ps_id, {});
  }

  $('#scatter-plot-form').change( on_select_change );
  $('#irrelevant-params').change( on_select_change );

  $('i.icon-arrow-down[id^="ps_down_"]').on('click', function () {
    var url = $(this).data('neighbor-url');
    move_current_ps(url);
  });
  $('i.icon-arrow-up[id^="ps_up_"]').on('click', function () {
    var url = $(this).data('neighbor-url');
    move_current_ps(url);
  });
