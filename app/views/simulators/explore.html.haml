= render partial: "shared/breadcrumb", locals: {links: breadcrumb_links_for(@simulator)}

- model_class = Simulator
.page-header
  %h1=t '.title', :default => @simulator.name

%h3 Plot

%form
  .form-inline
    #scatter-plot-form
      - parameter_keys = @simulator.parameter_definitions.map(&:key)
      = label_tag 'x_axis_key', "X-Axis"
      = select_tag 'x_axis_key', options_for_select(parameter_keys), id: 'x_axis_key'
      = label_tag 'y_axis_key', "Y-Axis"
      = select_tag 'y_axis_key', options_for_select(parameter_keys, selected: parameter_keys[1]), id: 'y_axis_key'
      = label_tag 'result', "Result"
      = select_tag 'result', options_for_select(@simulator.plottable), id: 'result', include_blank: true
    #irrelevant-params
      %br
      Irrelevant parameters :
      %br
      - @simulator.parameter_definitions.map(&:key).each do |key|
        = label_tag key, key
        = check_box_tag key

%hr

.row
  .span4
    %table.table.table-striped
      %tbody
        %tr
          %th ParameterSet
          %td#current_ps_id= @param_set.id.to_s
          %td
          %td
        - @simulator.parameter_definitions.map(&:key).each do |key|
          %tr
            %th= key
            %td{id: "ps_v_#{key}"}= @param_set.v[key]
            %td{style: "padding-left: 0; padding-right: 0;"}
              %i.icon-arrow-down
            %td{style: "padding-left: 0; padding-right: 0;"}
              %i.icon-arrow-up
  .span8
    - urls = {:"scatter-plot-url" => _scatter_plot_parameter_set_path('PSID') + '.json',
              :"ps-url" => parameter_set_path('PSID')+'.json' }
    #plot{data: urls }
      #plot-tooltip.plot-tooltip{style: "opacity: 0;"}

:css
  .axis path,
  .axis line {
    fill: none;
    stroke: #000;
    shape-rendering: crispEdges;
  }
  div.plot-tooltip {
    position: absolute;
    text-align: center;
    padding: 2px;
    font: 12px sans-serif;
    background: black;
    color: white;
    border: 0px;
    border-radius: 8px;
    pointer-events: none;
    z-index: 10;
  }

:javascript
  $(function() {
    var url_with_param = build_scatter_plot_url();
    var ps_id = $('td#current_ps_id').text();
    draw_explorer(url_with_param, ps_id);
  });

  function on_select_change() {
    var url = build_scatter_plot_url();
    var ps_id = $('td#current_ps_id').text();
    update_explorer(url, ps_id);
  }

  $('#scatter-plot-form').change( on_select_change );
  $('#irrelevant-params').change( on_select_change );
