= javascript_include_tag "explorer/application"

= render partial: "shared/breadcrumb", locals: {links: breadcrumb_links_for(@simulator)}

- model_class = Simulator
.page-header
  %h1=t '.title', :default => @simulator.name

#pc-plot

%hr

.row
  .col-md-4
    %table.table.table-striped
      %tbody
        %tr
          %th ParameterSet
          %td#current_ps_id= @param_set.id.to_s
          %td
          %td
        - domains = @simulator.parameter_ranges
        - @simulator.parameter_definitions.map(&:key).each do |key|
          %tr
            %th= key
            %td{id: "ps_v_#{key}", :"data-range" => domains[key] }= @param_set.v[key]
            %td{style: "padding-left: 0; padding-right: 0;"}
              - url = _neighbor_parameter_set_path('PSID') +".json?key=#{key}&direction=down"
              %i.fa.fa-arrow-down.clickable{id: "ps_down_#{key}", data: {"neighbor-url" => url}}
            %td{style: "padding-left: 0; padding-right: 0;"}
              - url = _neighbor_parameter_set_path('PSID') +".json?key=#{key}&direction=up"
              %i.fa.fa-arrow-up.clickable{id: "ps_up_#{key}", data: {"neighbor-url" => url}}
    %form.form-inline#scatter-plot-form{style: "line-height: 15px;"}
      - opts = @simulator.parameter_definitions.map(&:key)
      #forms-x
        %br
        = label_tag 'x_axis_key', "X-Axis: ", class: 'control-label scatter-plot-label'
        = select_tag 'x_axis_key', options_for_select(opts), id: 'x_axis_key', class: 'form-control input-sm'
        .checkbox
          %label
            %input#xlog{type: "checkbox"} Log Scale
      #forms-y
        %br
        = label_tag 'y_axis_key', "Y-Axis: ", class: 'control-label scatter-plot-label'
        = select_tag 'y_axis_key', options_for_select(opts, selected: opts[1]), id: 'y_axis_key', class: 'form-control input-sm'
        .checkbox
          %label
            %input#ylog{type: "checkbox"} Log Scale
      #form-result
        %br
        = label_tag 'result', "Result:", class: 'control-label'
        - opts = @simulator.plottable_domains.map {|key,domain| [key, key, {:"data-domain" => domain}] }
        = select_tag 'result', options_for_select(opts), id: 'result', class: 'form-control input-sm', include_blank: true
      #irrelevant-params
        %br
        %label Irrelevant Parameters:
        %br
        .checkbox
          - @simulator.parameter_definitions.map(&:key).each do |key|
            %label
              %input{type: "checkbox"}
                = key
      #result-range
        %br
        %label
          Result Range:
        .form-inline
          %input.input-sm.form-control#range-min{type: "text", placeholder: "min"}
          %input.input-sm.form-control#range-max{type: "text", placeholder: "max"}
  .col-md-8
    - urls = {"scatter-plot-url" => _scatter_plot_parameter_set_path('PSID') + '.json',
              "ps-url" => parameter_set_path('PSID')+'.json'}
    #plot{data: urls }
      #plot-tooltip.plot-tooltip

:css
  div.plot-tooltip {
    opacity: 0;
    position: absolute;
    text-align: center;
    padding: 2px;
    font: 12px sans-serif;
    background: black;
    color: white;
    border: 0px;
    border-radius: 8px;
    pointer-events: none;
    z-index: 10;
  }

:javascript
  var parameter_explorer = new ParameterExplorer();
  $(function() {
    parameter_explorer.Init();
  });

  $('#scatter-plot-form select').change( function() {parameter_explorer.Update();} );
  $('#irrelevant-params input').change( function() {parameter_explorer.Update();} );

  $('i.fa-arrow-down[id^="ps_down_"]').on('click', function () {
    parameter_explorer.MoveCurrentPs(this);
  });
  $('i.fa-arrow-up[id^="ps_up_"]').on('click', function () {
    parameter_explorer.MoveCurrentPs(this);
  });

